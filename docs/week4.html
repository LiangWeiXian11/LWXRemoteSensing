<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>LWXRemoteSensing - 4&nbsp; Week 4 Policy</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./summary.html" rel="next">
<link href="./week3.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./week4.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Week 4 Policy</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">LWXRemoteSensing</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Week1 Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Week2 ppt – to be done</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Week 3 Correction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week4.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Week 4 Policy</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary"><span class="header-section-number">4.1</span> Summary</a>
  <ul class="collapse">
  <li><a href="#shenzhen" id="toc-shenzhen" class="nav-link" data-scroll-target="#shenzhen"><span class="header-section-number">4.1.1</span> Shenzhen</a></li>
  <li><a href="#main-policy-challenges-and-targets" id="toc-main-policy-challenges-and-targets" class="nav-link" data-scroll-target="#main-policy-challenges-and-targets"><span class="header-section-number">4.1.2</span> Main policy challenges and targets</a></li>
  </ul></li>
  <li><a href="#application-of-eo-data-to-solve-the-policy-challenge" id="toc-application-of-eo-data-to-solve-the-policy-challenge" class="nav-link" data-scroll-target="#application-of-eo-data-to-solve-the-policy-challenge"><span class="header-section-number">4.2</span> Application of EO data (to solve the policy challenge)</a>
  <ul class="collapse">
  <li><a href="#rehabilitation-of-inefficient-forests-and-middle-aged-and-young-aged-forests-to-accurately-improve-forest-quality." id="toc-rehabilitation-of-inefficient-forests-and-middle-aged-and-young-aged-forests-to-accurately-improve-forest-quality." class="nav-link" data-scroll-target="#rehabilitation-of-inefficient-forests-and-middle-aged-and-young-aged-forests-to-accurately-improve-forest-quality."><span class="header-section-number">4.2.1</span> 1.Rehabilitation of inefficient forests and middle-aged and young-aged forests to accurately improve forest quality.</a></li>
  <li><a href="#improve-the-quality-of-water-source-conservation-forests-in-important-water-source-areas-and-strengthen-the-effect-of-soil-and-water-conservation." id="toc-improve-the-quality-of-water-source-conservation-forests-in-important-water-source-areas-and-strengthen-the-effect-of-soil-and-water-conservation." class="nav-link" data-scroll-target="#improve-the-quality-of-water-source-conservation-forests-in-important-water-source-areas-and-strengthen-the-effect-of-soil-and-water-conservation."><span class="header-section-number">4.2.2</span> 2.Improve the quality of water source conservation forests in important water source areas and strengthen the effect of soil and water conservation.</a></li>
  <li><a href="#promoting-urban-greening-and-upgrading-greening-quality" id="toc-promoting-urban-greening-and-upgrading-greening-quality" class="nav-link" data-scroll-target="#promoting-urban-greening-and-upgrading-greening-quality"><span class="header-section-number">4.2.3</span> 3.Promoting urban greening and upgrading greening quality</a></li>
  <li><a href="#promoting-the-construction-of-boulevards" id="toc-promoting-the-construction-of-boulevards" class="nav-link" data-scroll-target="#promoting-the-construction-of-boulevards"><span class="header-section-number">4.2.4</span> 4.Promoting the construction of boulevards</a></li>
  <li><a href="#connecting-mountain-and-water-ecological-corridor-networks" id="toc-connecting-mountain-and-water-ecological-corridor-networks" class="nav-link" data-scroll-target="#connecting-mountain-and-water-ecological-corridor-networks"><span class="header-section-number">4.2.5</span> 5.Connecting mountain and water ecological corridor networks</a></li>
  </ul></li>
  <li><a href="#reflection" id="toc-reflection" class="nav-link" data-scroll-target="#reflection"><span class="header-section-number">4.3</span> Reflection</a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span class="header-section-number">4.3.1</span> Data:</a></li>
  <li><a href="#method-or-theory" id="toc-method-or-theory" class="nav-link" data-scroll-target="#method-or-theory"><span class="header-section-number">4.3.2</span> Method or theory</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Week 4 Policy</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="summary" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="summary"><span class="header-section-number">4.1</span> Summary</h2>
<section id="shenzhen" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="shenzhen"><span class="header-section-number">4.1.1</span> Shenzhen</h3>
<ol type="1">
<li><p>Due to the high population density and intense socio-economic activities in Shenzhen, there’s significant disruption and pressure on the ecological environment. As a result, the overall fragmentation index of the ecological landscape keeps rising, leading to insufficient ecological connectivity between green spaces. This trend is causing ecological spaces to become isolated and fragmented, and there’s an urgent need to enhance the connectivity of ecological corridors.</p></li>
<li><p>The distribution of ecological recreational spaces is uneven, and there’s a need to improve accessibility and connectivity of facilities. Existing parks face challenges such as limited per capita green space resources and uneven development of green ecology in different areas. The quality and functionality of ecological recreational spaces need improvement. The connectivity of park networks and pedestrian accessibility also need to be enhanced.</p></li>
</ol>
<p>&lt;Circular of the Shenzhen Municipal People’s Government on the Issuance of the Shenzhen Park City Construction Master Plan and Three-Year Action Plan (2022-2024)&gt;</p>
</section>
<section id="main-policy-challenges-and-targets" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="main-policy-challenges-and-targets"><span class="header-section-number">4.1.2</span> Main policy challenges and targets</h3>
<ol type="1">
<li><p>Improve the quality of inefficient forests and young forests, accurately enhancing forest quality.</p>
<p>In natural suburban parks, we will nurture and thin out large areas of concentrated young forests to promote forest transformation. This includes promoting tree growth, removing low-quality trees, increasing forest quality and volume, and enhancing forest carbon storage.</p></li>
<li><p>Enhance the quality of water conservation forests in important water source areas, strengthening soil and water conservation effects.</p>
<p>We will carry out forest transformation and nurturing of young forests around water conservation areas to improve the quality of fast-growing artificial forests and young forests.</p></li>
<li><p>Promoting urban greening and upgrading greening quality</p>
<p>Analyze shortcomings in urban greening and identify key areas for the construction of tree-lined roads and vertical greening.</p></li>
<li><p>Promoting the construction of boulevards</p>
<p>Comprehensively promote the construction and nurturing of boulevards on roads whose shade coverage rate does not meet the standards, enhance the coverage rate of boulevards in built-up areas of cities, and promote the linking of boulevards into pieces.</p></li>
<li><p>Connecting mountain and water ecological corridor networks</p>
<ol type="1">
<li><p>Connect natural mountain areas and green spaces through ecological green corridors or ecological bridges to promote connectivity of mountain forests and green corridors.</p></li>
<li><p>Utilize nearby lakes and reservoirs along with surrounding mountain forest resources to create a network of suburban trails and lakeside pathways.</p></li>
</ol></li>
</ol>
</section>
</section>
<section id="application-of-eo-data-to-solve-the-policy-challenge" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="application-of-eo-data-to-solve-the-policy-challenge"><span class="header-section-number">4.2</span> Application of EO data (to solve the policy challenge)</h2>
<section id="rehabilitation-of-inefficient-forests-and-middle-aged-and-young-aged-forests-to-accurately-improve-forest-quality." class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="rehabilitation-of-inefficient-forests-and-middle-aged-and-young-aged-forests-to-accurately-improve-forest-quality."><span class="header-section-number">4.2.1</span> 1.Rehabilitation of inefficient forests and middle-aged and young-aged forests to accurately improve forest quality.</h3>
<p>Identify inefficient forests and young and middle-aged forests to provide a basis for subsequent accurate improvement of forest quality.</p>
<ol type="1">
<li><p>Extraction of large-scale concentrated and continuous young and middle-aged forests by NDVI.</p>
<ol type="1">
<li><p>Calculate ndvi by using the red and near-infrared bands of Landset data.</p></li>
<li><p>Extracting areas with large ndvi values as targets for subsequent improvement.</p></li>
</ol></li>
<li><p>Identifying poor quality trees</p>
<ol type="1">
<li><p>NDVI can be used to assess the health of vegetation. Since NDVI can be used to reflect the sparseness and growth status of vegetation, the NDVI of poor quality forests is usually lower than that of healthy forests.</p></li>
<li><p>DEM can reflect the slope and height of the terrain. Sometimes, poor-quality forest trees are distributed in areas with steep terrain. Therefore, we can use DEM to assist in identifying poor quality vegetation.</p></li>
</ol></li>
</ol>
</section>
<section id="improve-the-quality-of-water-source-conservation-forests-in-important-water-source-areas-and-strengthen-the-effect-of-soil-and-water-conservation." class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="improve-the-quality-of-water-source-conservation-forests-in-important-water-source-areas-and-strengthen-the-effect-of-soil-and-water-conservation."><span class="header-section-number">4.2.2</span> 2.Improve the quality of water source conservation forests in important water source areas and strengthen the effect of soil and water conservation.</h3>
<p>Identify the vegetation around the water protection zone and count the area</p>
<ol type="1">
<li><p>We calculate the NDWI for extracting water using Landset data (landset - NDWI)</p></li>
<li><p>We extracted vegetation around water zone using NDVI and count the total area</p></li>
</ol>
</section>
<section id="promoting-urban-greening-and-upgrading-greening-quality" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="promoting-urban-greening-and-upgrading-greening-quality"><span class="header-section-number">4.2.3</span> 3.Promoting urban greening and upgrading greening quality</h3>
<p>Calculating the accessibility of green space in each region (per capita) and determining the priority areas for green construction</p>
<ol type="1">
<li><p>using landset data to calculate NDVI and extracted vegetation.</p></li>
<li><p>Calculating the total area of green space in each region</p></li>
<li><p>quantify the green space accessibility per capita by network analysis using population raster data and road vector data</p></li>
</ol>
</section>
<section id="promoting-the-construction-of-boulevards" class="level3" data-number="4.2.4">
<h3 data-number="4.2.4" class="anchored" data-anchor-id="promoting-the-construction-of-boulevards"><span class="header-section-number">4.2.4</span> 4.Promoting the construction of boulevards</h3>
<p>Identification of roads with substandard shade coverage rate</p>
<ol type="1">
<li><p>Identify trees around roads through road vector data and high-precision revolution remote sensing images (smaller than 1M spatial resolution and may collected by drones)</p></li>
<li><p>Identify roads with low shade coverage through regional statistics, as a subsequent focus of construction, to improve the coverage of shade roads in urban built-up areas</p></li>
</ol>
</section>
<section id="connecting-mountain-and-water-ecological-corridor-networks" class="level3" data-number="4.2.5">
<h3 data-number="4.2.5" class="anchored" data-anchor-id="connecting-mountain-and-water-ecological-corridor-networks"><span class="header-section-number">4.2.5</span> 5.Connecting mountain and water ecological corridor networks</h3>
<p>Identification of water, forests and green spaces and identification of ecological corridors</p>
<ol type="1">
<li><p>We use landset (ndvi, ndwi) and DEM data to extract water bodies, forests and green spaces.</p></li>
<li><p>Building cost surface raster (through DEM and urban landuse raster data) in <a href="https://www.esri.com/en-us/arcgis/products/arcgis-pro/overview">ArcGIS pro</a></p></li>
<li><p>Calculate <a href="https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-analyst/least-cost-corridor.htm">Least Cost Corridor</a> through (ArcGIS pro) Spatial Analyst toolset.</p></li>
</ol>
</section>
</section>
<section id="reflection" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="reflection"><span class="header-section-number">4.3</span> Reflection</h2>
<section id="data" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="data"><span class="header-section-number">4.3.1</span> Data:</h3>
<ol type="1">
<li><p>DEM</p></li>
<li><p>Landset</p></li>
<li><p>Landuse</p></li>
</ol>
</section>
<section id="method-or-theory" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="method-or-theory"><span class="header-section-number">4.3.2</span> Method or theory</h3>
<ol type="1">
<li><p>NDVI (Normalized Difference Vegetation Index) is an index which can be used to assess the health and growth stage of vegetation</p></li>
<li><p>NDWI</p></li>
<li><p>Least Cost Corridor</p></li>
<li><p>Accessibility of green space</p></li>
</ol>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./week3.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Week 3 Correction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./summary.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Summary</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>